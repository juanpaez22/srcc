<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stone Ranch Command Center</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header class="site-header">
            <div class="logo-section">
                <img src="/static/longhorn.png" class="logo-img" alt="Stone Ranch">
                <h1>Stone Ranch Command Center</h1>
            </div>
            <nav class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/chores_page">Chores</a>
                <a href="/telemetry">Tracker</a>
            </nav>
        </header>

        <main class="main-content">
            <section class="welcome-section">
                <h2>Welcome to Stone Ranch</h2>
                <p class="date" id="current-date"></p>
            </section>

            {% if missing_users or completed_users %}
            <section class="card checkin-prompt">
                <h2>Daily Check-in</h2>
                <p>Yesterday ({{ yesterday }}):</p>
                {% if completed_users %}
                <p style="color: #4caf50;">‚úì Completed: {{ completed_users|join(', ') }}</p>
                {% endif %}
                {% if missing_users %}
                <p style="color: #f44336;">‚úó Missing: {{ missing_users|join(', ') }}</p>
                <a href="/telemetry?date={{ yesterday }}" class="btn">Fill Out Now</a>
                {% endif %}
            </section>
            {% endif %}

            <section class="card weather-card">
                <h2>{{ weather_city }} Weather</h2>
                <div class="weather-current">
                    <div class="weather-main">
                        <span class="temp" id="temp">--</span>
                        <span class="degree">¬∞F</span>
                    </div>
                    <div class="weather-details">
                        <span class="condition" id="condition">Loading...</span>
                        <span class="wind">Wind: <span id="wind">--</span> mph</span>
                    </div>
                </div>
                <div class="weather-forecast" id="forecast"></div>
            </section>

            <section class="card stocks-card">
                <h2>Stocks</h2>
                <div class="stocks-grid" id="stocks-grid">
                    <span class="stocks-loading">Loading...</span>
                </div>
            </section>

            <section class="chores-section card" id="chores-section" style="display: none;">
                <h2>Today's Chores</h2>
                <ul class="chores-list" id="chores-list"></ul>
            </section>

            <section class="news-section">
                <div class="news-category">
                    <h3>World News</h3>
                    <div class="news-ticker" id="news-world"></div>
                </div>
                <div class="news-category">
                    <h3>Tech News</h3>
                    <div class="news-ticker" id="news-tech"></div>
                </div>
            </section>
        </main>

        <footer class="telemetry">
            <h3>System Status</h3>
            <div class="stats-grid">
                <div class="stat-box">
                    <span class="stat-label">CPU</span>
                    <span class="stat-value" id="cpu">--%</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Memory</span>
                    <span class="stat-value" id="memory">--%</span>
                </div>
                <div class="stat-box">
                    <span class="stat-label">Updated</span>
                    <span class="stat-value" id="time">--:--:--</span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        document.getElementById('current-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

        const weatherCodes = {
            0: '‚òÄÔ∏è', 1: 'üå§Ô∏è', 2: '‚õÖ', 3: '‚òÅÔ∏è',
            45: 'üå´Ô∏è', 48: 'üå´Ô∏è',
            51: 'üåßÔ∏è', 53: 'üåßÔ∏è', 55: 'üåßÔ∏è',
            61: 'üåßÔ∏è', 63: 'üåßÔ∏è', 65: 'üåßÔ∏è',
            71: 'üå®Ô∏è', 73: 'üå®Ô∏è', 75: 'üå®Ô∏è',
            80: 'üå¶Ô∏è', 81: 'üå¶Ô∏è', 82: 'üå¶Ô∏è',
            95: '‚õàÔ∏è', 96: '‚õàÔ∏è'
        };

        function updateStats() {
            fetch('/stats')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('cpu').textContent = data.cpu + '%';
                    document.getElementById('memory').textContent = data.memory + '%';
                    document.getElementById('time').textContent = data.time;
                });
        }

        function updateWeather() {
            fetch('/weather')
                .then(r => r.json())
                .then(data => {
                    if (data.error) {
                        document.getElementById('condition').textContent = 'Error';
                        return;
                    }
                    document.getElementById('temp').textContent = data.temp;
                    document.getElementById('condition').textContent = data.condition;
                    document.getElementById('wind').textContent = data.wind;
                    
                    const forecast = document.getElementById('forecast');
                    forecast.innerHTML = data.forecast.map(f => 
                        `<div class="forecast-hour"><span class="f-time">${f.time}</span><span class="f-icon">${weatherCodes[f.code] || 'üå°Ô∏è'}</span><span class="f-temp">${f.temp}¬∞</span></div>`
                    ).join('');
                });
        }

        function updateStocks() {
            fetch('/stocks')
                .then(r => r.json())
                .then(data => {
                    const grid = document.getElementById('stocks-grid');
                    if (data.stocks.length === 0) {
                        grid.innerHTML = '<span>Unable to load stocks</span>';
                        return;
                    }
                    grid.innerHTML = data.stocks.map(s => `
                        <div class="stock-item">
                            <span class="stock-symbol">${s.symbol}</span>
                            <span class="stock-price">$${s.price}</span>
                            <span class="stock-change ${s.change >= 0 ? 'up' : 'down'}">${s.change >= 0 ? '+' : ''}${s.change_pct}%</span>
                        </div>
                    `).join('');
                });
        }

        function updateNews() {
            fetch('/news')
                .then(r => r.json())
                .then(data => {
                    const world = data.articles.filter(a => a.category === 'world');
                    const tech = data.articles.filter(a => a.category === 'tech');
                    
                    document.getElementById('news-world').innerHTML = world.map(a => 
                        `<a href="${a.link}" target="_blank" class="news-item">${a.title}</a>`
                    ).join('');
                    
                    document.getElementById('news-tech').innerHTML = tech.map(a => 
                        `<a href="${a.link}" target="_blank" class="news-item">${a.title} <span class="news-source">(${a.source})</span></a>`
                    ).join('');
                });
        }

        function updateChores() {
            fetch('/chores')
                .then(r => r.json())
                .then(data => {
                    const section = document.getElementById('chores-section');
                    const list = document.getElementById('chores-list');
                    
                    if (data.chores.length > 0) {
                        section.style.display = 'block';
                        list.innerHTML = data.chores.map(c => `<li>${c}</li>`).join('');
                    } else {
                        section.style.display = 'none';
                    }
                });
        }

        updateStats();
        updateWeather();
        updateStocks();
        updateNews();
        updateChores();
        setInterval(updateStats, 3000);
        setInterval(updateWeather, 300000);
        setInterval(updateStocks, 60000);
        setInterval(updateNews, 300000);
    </script>
</body>
</html>
